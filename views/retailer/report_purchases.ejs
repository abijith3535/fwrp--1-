<!DOCTYPE html>
<html lang="en">

<head>

  <%- include('../partials/head') %>
   <!-- Data Table Css -->
   <link rel="stylesheet" type="text/css" href="/retailer/files/bower_components/datatables.net-bs4/css/dataTables.bootstrap4.min.css">
   <link rel="stylesheet" type="text/css" href="/retailer/files/assets/pages/data-table/css/buttons.dataTables.min.css">
   <link rel="stylesheet" type="text/css" href="/retailer/files/bower_components/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css">
</head>

<body>
     <!-- [ Pre-loader ] start -->
     
    <!-- [ Pre-loader ] end -->
    <div id="pcoded" class="pcoded">
        <div class="pcoded-overlay-box"></div>
        <div class="pcoded-container navbar-wrapper">
            
            <%- include('../partials/topnav') %>
            

            <div class="pcoded-main-container">
                <div class="pcoded-wrapper">
                    <!-- [ navigation menu ] start -->
                    <%- include('../partials/sidebar') %>
                    <!-- [ navigation menu ] end -->
                    <div class="pcoded-content">
                        <div class="page-header card">
                            <div class="row align-items-end">
                                <div class="col-lg-8">
                                    <div class="page-header-title">
                                        <i class="feather icon-watch bg-c-blue"></i>
                                        <div class="d-inline">
                                            <h5>Purchase Report</h5>
                                            <span>Show the reports with in a date range</span>
                                        </div>
                                    </div>
                                </div>
                               
                            </div>
                        </div>
                        <!-- [ breadcrumb ] end -->
                        <div class="pcoded-inner-content">
                            <div class="main-body">
                                <div class="page-wrapper">
                                    <div class="page-body">
                                        <!-- [ page content ] start -->
                        <div class="row">
                            <div class="col-sm-12">
                                <div class="card">
                                    <div class="card-block">
                                        <div class="row">
                                   
                                            <div class="col-sm-6">
                                                <div class="form-group form-primary">
                                                    <label class="form-label float-label">From</label>
                                                    <input type="date" name="text" class="form-control" id="from" >
                                                    <span class="form-bar"></span>
                                                    
                                                </div>
                                            </div>
                                            <div class="col-sm-6">
                                                <div class="form-group form-primary">
                                                    <label class="form-label float-label">To</label>
                                                    <input type="date" name="to" class="form-control" id="to">
                                                    <span class="form-bar"></span>
                                                   
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row m-t-30 text-center">
                                            <div class="col-md-6 ">
                                                <div class="d-grid">
                                                    <button class="btn btn-primary btn-md waves-effect text-center m-b-20 report-btn" type="button">Generate</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                                
                            </div>
                        </div>
                                        <div class="row">
                                            <div class="col-sm-12">
                                                <div class="card">
                                                    <div class="card-header">
                                                        <h5>Purchases</h5>
                                                        <div class="card-header-right">
                                                            <ul class="list-unstyled card-option">
                                                                <li class="first-opt"><i class="feather icon-chevron-left open-card-option"></i></li>
                                                                <li><i class="feather icon-maximize full-card"></i></li>
                                                                <li><i class="feather icon-minus minimize-card"></i></li>
                                                                <li><i class="feather icon-refresh-cw reload-card"></i></li>
                                                                <li><i class="feather icon-trash close-card"></i></li>                                                                 <li><i class="feather icon-chevron-left open-card-option"></i></li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                    <div class="card-block">
                                                        <div class="table-responsive dt-responsive">
                                                            <table id="colum-rendr" class="table table-striped table-bordered nowrap">
                                                              <thead>
                                                                <tr>
                                                                  <th>No</th>
                                                                  <th>Id </th>
                                                                  <th>User</th>
                                                                  <th>Date</th>
                                                                  <th>Total price</th>
                                                                  <th>Status</th>
                                                                  <th>Action</th>
                                                                </tr>
                                                              </thead>
                                                              <tbody id="reportTblBody">
                                                              </tbody>
                                                           
                                                              <tfoot>
                                                                <tr>
                                                                    <th>No</th>
                                                                    <th>Id </th>
                                                                    <th>User</th>
                                                                    <th>Date</th>
                                                                    <th>Total price</th>
                                                                    <th>Status</th>
                                                                    <th>Action</th>
                                                                </tr>
                                                              </tfoot>
                                                            </table>
                                                          </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- [ page content ] end -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- [ style Customizer ] start -->
                    <div id="styleSelector">
                    </div>
                    <!-- [ style Customizer ] end -->
                </div>
            </div>
        </div>
    </div>

    <%- include('../partials/scripts') %>
     <!-- data-table js -->
<script src="/retailer/files/bower_components/datatables.net/js/jquery.dataTables.min.js"></script>
<script src="/retailer/files/bower_components/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
<script src="/retailer/files/assets/pages/data-table/js/jszip.min.js"></script>
<script src="/retailer/files/assets/pages/data-table/js/pdfmake.min.js"></script>
<script src="/retailer/files/assets/pages/data-table/js/vfs_fonts.js"></script>
<script src="/retailer/files/bower_components/datatables.net-buttons/js/buttons.print.min.js"></script>
<script src="/retailer/files/bower_components/datatables.net-buttons/js/buttons.html5.min.js"></script>
<script src="/retailer/files/bower_components/datatables.net-bs4/js/dataTables.bootstrap4.min.js"></script>
<script src="/retailer/files/bower_components/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
<script src="/retailer/files/bower_components/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js"></script>
     <!-- Custom js -->
     <script src="/retailer/files/assets/js/pcoded.min.js"></script>
     <script src="/retailer/files/assets/js/vertical/vertical-layout.min.js"></script>

     <script type="text/javascript" src="/retailer/files/assets/js/script.min.js"></script>
     <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
     <script>
        document.querySelectorAll('.dateformat').forEach(function(el) {
            const d = el.textContent; 
            const formattedDate = moment(d).format('YYYY-MM-DD'); 
            el.textContent = formattedDate; //
        });
    </script>
     <script>
        $(document).ready(function(){
            $('#colum-rendr').DataTable({});
        })
     </script>
     <script>
        $(document).ready(function () {
            $('.report-btn').on('click', function (e) {
                e.preventDefault(); // Prevent the default form submission
                console.log($('#from').val(),$('#to').val());
                $('#reportTblBody').html("");
             if($('#from').val() == '' && $('#to').val() == '')   
             {
                alertify.error('Please choose dates');
             }
             else{
                    const jsonData = {
                        from: $('#from').val(),
                        to: $('#to').val()
                    };
                    console.log(jsonData);
                    $.ajax({
                        url: '<%= siteName %>/retailer/reports/generate-report-purchases', // Endpoint in your Express app
                        type: 'POST',
                        data: JSON.stringify(jsonData),  
                        contentType: 'application/json',  
                        success: function (response) {
                            console.log(response);
                        if(response.message =='success')
                        {
                            var tbl = '';
                            var baseurl = $('#baseurl').val();
                            $.each(response.report, function(index, e) {
                               tbl = tbl + `<tr>
                                        <td>${index + 1}</td>
                                        <td>${e.order_unique } </td>
                                         <td>${e.name } </td>
                                         <td>${e.purchase_date } </td>
                                         <td>${e.total_price } </td>
                                         <td>${e.status } </td>
                                         <td><a href="${baseurl}/retailer/purchases/${e.order_id}" class="btn btn-success waves-effect waves-light "><i class="fa fa-eye"></i></a></td>
                                    </tr>`;
                            });
                            $('#reportTblBody').append(tbl);
                        }
                       
                        
                        
                        },
                        error: function (error) {
                            console.log(error);
                            
                            var errors_ = JSON.parse(error.responseText);
                        console.log(errors_);
                        $.each(errors_.errors, function(index, e) {
                            alertify.error(e);
                        });
                            
                        }
                    });
                }
            });
        });
  
    </script>
     
</body>

</html>